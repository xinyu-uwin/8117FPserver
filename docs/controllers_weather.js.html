<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: controllers/weather.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: controllers/weather.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const https = require('https')

/**
 * Get weather details from 'openweathermap' API
 * @param {*} req accepts request body and params
 * @param {*} res responds with status and body data
 * @returns the weather data as response
 */
exports.weatherdata = (req, res) => {
    try {
        if (!req.body.location &amp;&amp; !req.query.location) {
            return res.status(400).send({status: 400, msg: "Location not entered properly!" })
        }
        let location
        if(req.body.location){
            location = req.body.location
        }else{
            location = req.query.location
        }
        const api_key = process.env.WEATHER_API_ACCESS_KEY
        const api = "https://api.openweathermap.org/data/2.5/weather?q=" + location + "&amp;APPID=" + api_key
        /**
         * Sending request to 'openweathermap' external API
         */
        https.get(api, (response) => {
            if(response.statusCode != 200){
                return res.status(404).send({status: 404, msg: "City not found! reenter the city!"})
            }
            response.on('data', (data)=>{
                const data_json = JSON.parse(data)
                const weather_data = data_json.weather[0]
                const temp_data = data_json.main
                console.log(data_json)
                /**
                 * convert temp from kelvin to celcius Celsius = (Kelvin â€“ 273.15)
                 */
                const temperature = parseInt(temp_data.temp - 273.15)
                const feels_like = parseInt(temp_data.feels_like - 273.15)
                const data_to_send = {climate: weather_data.main, description: weather_data.description, place: data_json.name, country: data_json.sys.country, temperature, feels_like, unit: "celsius"}
                return res.status(200).send({status: 200, body:data_to_send})
            })
        })
    } catch (e) {
        console.log("error:", e)
        return res.status(400).send({status: 400, msg: "error encountered!" })
    }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addRoom">addRoom</a></li><li><a href="global.html#alarmTrigger">alarmTrigger</a></li><li><a href="global.html#alarmTriggerOff">alarmTriggerOff</a></li><li><a href="global.html#automateAlarmTrigger">automateAlarmTrigger</a></li><li><a href="global.html#automateThermostat">automateThermostat</a></li><li><a href="global.html#client">client</a></li><li><a href="global.html#details">details</a></li><li><a href="global.html#deviceControl">deviceControl</a></li><li><a href="global.html#express">express</a></li><li><a href="global.html#forgot_password_send_otp">forgot_password_send_otp</a></li><li><a href="global.html#forgot_password_verify_otp">forgot_password_verify_otp</a></li><li><a href="global.html#login">login</a></li><li><a href="global.html#logout">logout</a></li><li><a href="global.html#register">register</a></li><li><a href="global.html#removeRoom">removeRoom</a></li><li><a href="global.html#reset_password">reset_password</a></li><li><a href="global.html#router">router</a></li><li><a href="global.html#send_otp">send_otp</a></li><li><a href="global.html#settings">settings</a></li><li><a href="global.html#transporter">transporter</a></li><li><a href="global.html#updateThermostat">updateThermostat</a></li><li><a href="global.html#userdetails">userdetails</a></li><li><a href="global.html#weatherdata">weatherdata</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.0</a> on Thu Nov 17 2022 18:44:02 GMT-0500 (Eastern Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
